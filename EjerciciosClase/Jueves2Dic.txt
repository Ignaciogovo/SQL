CREATE TABLE menu_hco(
id int identity(1,1) PRIMARY KEY,
idMenu int NOT NULL,
nombre Varchar(100) not null,
precioVenta varchar(100) not null,
fecha datetime not null
)


trigger:
CREATE TRIGGER HistoricoPrecio
on menu
for update, insert
as
BEGIN
set nocount on; /*Esto permite que no se escriban lineas en la consola(No sea visual el cambio)*/
if UPDATE(PrecioVenta)
begin
insert into menu_hco
	select ID,nombre,precioVenta,GETDATE()
	From inserted
	end
end







Create table Prueba(
id int primary key not null,
named varchar(100),
matricula varchar(9) not null)





CREATE or alter TRIGGER seguridadBorrarTabla
on database
for drop_table
as
print 'Pringao, desactiva el trigger'
rollback





La tabla pedidos y pedidoslinea del arepazo están relacionadas. Queremos que al añadir una linea a un pedido, se recalcule automaticamente el importe total de la tabla pedidos.
•Analiza cómo funcionan los importes de esas tablas

•Haz una consulta que dado un numero de pedido, te sume el importe * la cantidad de cada linea que haya en pedidoslinea

•Escribe un update que actualice el campo total de la tabla pedidos y lo sobreescriba con la suma calculada anteriormente

•Escribe un trigger, que cuando se inserte o modifique una linea, se autocalcule el importe total del pedido.




update PedidosLinea
set PrecioVentaUnitario = 13, Cantidad = 3
where Id = 1
go
select * from pedidoslinea
CREATE or alter TRIGGER modificarPrecio
on pedidoslinea
for insert, update
as
begin 
declare @id as int=(select idpedido from inserted)
declare @preciomod as decimal(18,2) (select sum(Cantidad*PrecioVentaUnitario) as preciototal from PedidosLinea where IdPedido=@id)
update Pedidos
set pedidos.Total=@preciomod
end